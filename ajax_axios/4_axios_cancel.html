<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>chain</title>
</head>
<body>
<div>
    <button onclick="getProducts1()">获取商品列表1</button>
    <br>
    <button onclick="getProducts2()">获取商品列表2</button>
    <br>
    <button onclick="cancelReq()">取消请求</button>
    <br>
</div>
</body>
<script src="https://cdn.bootcss.com/axios/0.19.0/axios.js"></script>
<script type="text/javascript">

    /**
     * 取消请求:
     */
    let cancel //用于保存取消请求函数
    function getProducts1() {
        //发出新请求前取消未完成的请求
        if (typeof cancel === 'function') {
            cancel('取消请求')
        }
        axios({
            url:'http://localhost:4000/products1',
            cancelToken: new axios.CancelToken(c => {
                //保存取消请求函数, 可以取消当前请求
                cancel = c
            })
        })
            .then(response => {
                cancel = null
                console.log('data', response.data)
            })
            .catch(error => {
                if (axios.isCancel(error)) {
                    // cancel = null;
                    console.log('isCancelerror', error.message)
                } else {
                    cancel = null;
                    console.log('error', error.message)
                }
            });

    }
    function getProducts2() {
        if (typeof cancel === 'function') {
            cancel('取消请求')
        }
        axios({
            url:'http://localhost:4000/products2',
            cancelToken: new axios.CancelToken(c => {
                //保存取消请求函数, 可以取消当前请求
                cancel = c
            })
        })
            .then(response => {
                cancel = null
                console.log('getProducts2data', response.data)
            })
            .catch(error => {
                if (axios.isCancel(error)) {
                    // cancel = null;
                    console.log('getProducts2isCancelerror', error.message)
                } else {
                    cancel = null;
                    console.log('getProducts2error', error.message)
                }
            })
    }

    function cancelReq() {
        if (typeof cancel == 'function') {
            cancel('取消请求')
        }else {
            console.log('无请求可取消')
        }
    }


</script>
</html>
