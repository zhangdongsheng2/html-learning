<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>chain</title>
</head>
<body>
<div>
    <button onclick="getProducts1()">获取商品列表1</button>
    <br>
    <button onclick="getProducts2()">获取商品列表2</button>
    <br>
    <button onclick="cancelReq()">取消请求</button>
    <br>
</div>
</body>
<script src="https://cdn.bootcss.com/axios/0.19.0/axios.js"></script>
<script type="text/javascript">

    /**
     * 取消请求:
     */
    let cancel
    axios.interceptors.request.use(config => {
        //发出新请求前取消未完成的请求
        if (typeof cancel === 'function') {
            cancel('取消请求')
        }
        config.cancelToken = new axios.CancelToken(c => {
            //保存取消请求函数, 可以取消当前请求
            cancel = c
        })
        return config
    })

    axios.interceptors.response.use(response => {
        cancel = null
        return response
    },
    error => {
        if (axios.isCancel(error)) {
            // cancel = null;
            console.log('isCancelerror', error.message)
            return new Promise(()=>{})
        } else {
            cancel = null;
            console.log('error', error.message)
            return new Promise.reject(error)
        }
    })





    function getProducts1() {

        axios({
            url:'http://localhost:4000/products1',

        })
            .then(response => {
                console.log('请求1成功', response.data)
            })
            .catch(error => {
                console.log('请求1失败', error.message)
            });

    }
    function getProducts2() {
        axios({
            url:'http://localhost:4000/products2',
        })
            .then(response => {
                console.log('请求2成功', response.data)
            })
            .catch(error => {
                console.log('请求2失败', error.message)
            });
    }

    function cancelReq() {
        if (typeof cancel == 'function') {
            cancel('取消请求')
        }else {
            console.log('无请求可取消')
        }
    }


</script>
</html>
