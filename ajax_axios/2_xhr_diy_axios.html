<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>restapi</title>
</head>
<body>
<div>
    <button onclick="testGet()">GET请求</button>
    <button onclick="testPOST()">POST请求</button>
    <button onclick="testPut()">PUT请求</button>
    <button onclick="testDelete()">DELETE请求</button>
</div>
</body>
<script type="text/javascript">
    //GET请求
    function testGet() {
        axios({
            url: 'http://localhost:3000/posts',
            method: 'GET',
            params:{
                id:1,
                // title:'json-serve2'
            }
        }).then(response => {
            console.log(response.data)
        })
    }

    //POST请求
    function testPOST() {
        axios({
            url: 'http://localhost:3000/posts',
            method: 'POST',
            data:{"title": "json-server39", "auther": "typicode39"}
        }).then(response => {
            console.log(response.data)
        })
    }

    //PUT请求
    function testPut() {
        axios({
            url: 'http://localhost:3000/posts/3',
            method: 'PUT',
            data:{"title": "json-999", "auther": "999"}
        }).then(response => {
            console.log(response.data)
        })
    }

    //DElete请求
    function testDelete() {
        axios({
            url: 'http://localhost:3000/posts/4',
            method: 'delete'
        }).then(response => {
            console.log(response.data)
        })
    }


    function axios({
                       url,//请求地址
                       method = 'GET',//请求方式
                       params = {},//get/delete 请求参数
                       data = {}//post/delete 请求参数
                   }) {
        /*
        0. 创建异步对象 promise
        1. 处理url和数据. 创建请求xhr对象.
        2. 跟进请求方式设置header,
        3. 完成请求, 返回异步结果
         */
        //返回一个promise
        return new Promise((resolve, reject)=>{
            //method处理成大写
            method = method.toUpperCase();

            //处理对象参数转url
            let queryString = ''
            Object.keys(params).forEach(key => {
                queryString += `${key}=${params[key]}&`
            })
            if (queryString) {
                url += "?"+queryString.substring(0,queryString.length-1)
            }

            //传教请求对象执行请求
            const request = new XMLHttpRequest();
            request.open(method,url,true)

            if(method === 'GET' || method === 'DELETE'){
                request.send()
            }else if (method === 'POST' || method === 'PUT') {
                request.setRequestHeader('Content-Type','application/json;charset=utr-8')
                request.send(JSON.stringify(data))
            }

            //绑定状态改变监听
            request.onreadystatechange = function () {
                //没有完成直接结束
                if (request.readyState!==4){
                    return
                }
                //获取响应码 [200,300] 之间代表成功
                const {status,statusText} = request;
                if(status>=200 && status<=299){
                    //结果数据格式化
                    const response = {
                        data: JSON.parse(request.response),
                        status,
                        statusText
                    }
                    resolve(response)
                }else {
                    reject(new Error('request error status is '+status))
                }

            };

        })


    }

</script>
</html>
