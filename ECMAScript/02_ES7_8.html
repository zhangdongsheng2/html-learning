<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ES7_8</title>
</head>
<body>
<h1>ES7_8</h1>
<ul>
    <li>ES7_includes_**</li>
    <li>ES8_async_await</li>
    <li>ES8_对象扩展方法</li>

</ul>
</body>


<script>
    console.log('============================ES7_includes_**开始===================================');
    const mingzhu = ['xiyouji','xinlan','sanguo']
    //判断是否包含
    console.log(mingzhu.includes('xiyouji'))

    console.log("2 ** 10次方: ",2 ** 10)
    console.log("Math.pow(2,10)次方:",Math.pow(2,10))
    console.log('============================ES7_includes_**结束===================================');
    console.log('============================ES8_async_await开始===================================');
    /*
      mdn文档:
        https: //developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/async_function
        https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/await
      1. async 函数
        函数的返回值为promise对象
        promise对象的结果由async函数执行的返回值决定

      2. await 表达式
        await右侧的表达式一般为promise对象, 但也可以是其它的值
          如果表达式是promise对象, await返回的是promise成功的值
          如果表达式是其它值, 直接将此值作为await的返回值

      3. 注意:
        await必须写在async函数中, 但async函数中可以没有await
        如果await的promise失败了, 就会抛出异常, 需要通过try...catch来捕获处理
    */

    console.log("简单使用")
    //async 函数返回值是 promise 对象,如果不是就做封装, 返回的promise结果由函数返回值决定,  如果 return new Promise,则不做封装.
    async function fn1(){
        // return 1;
        // return Promise.reject(2)
        return new Promise((resolve, reject)=>{
            resolve(3)
        })
    }
    const promiseFn1 = fn1();
    console.log(promiseFn1)

    promiseFn1.then(value => {
        console.log("async返回对象promise的值: ",value)
    },reason => {
        console.log("async返回对象promise的reason值: ",reason)
    })


    function fn2() {
        return new Promise((resolve, reject) => {
            setTimeout(()=>{
                resolve(5)
            },1000)
        })
    }
    function fn3() {
        return 6;
    }

    let p =  new Promise((resolve, reject) => {
        setTimeout(()=>{
            resolve(5)
        },1000)
    })

    async function fn4() {
        try {
            //右侧为promise, 得到结果为成功的promise值.  右侧为普通数值得到的就是普通数值
            // const newVar = await fn2();
            // const newVar = await fn3();
            const newVar = await p;// await 必须放async函数中
            console.log("await结果值: ", newVar)
            return newVar
        } catch (e) {
            console.log("失败报错")
        }

    }
    fn4().then(value => console.log("async结果值: ",value));


    console.log("封装Ajax请求")

    function fn5(url) {
       return new Promise(function (resolve, reject) {
           //2. 创建xhr
           const xhr = new XMLHttpRequest();
           //3. 初始化
           xhr.open("GET",url);
           xhr.send();
           console.log("发起请求")
           //4. 绑定事件处理结果
           xhr.onreadystatechange = function () {
               if (xhr.readyState === 4) {
                   if (xhr.status >= 200 && xhr.status < 300) {
                       resolve(xhr.response);
                   } else {
                       reject(xhr.response);
                   }
               }
           };
       });
    }

    fn5("https://api.apiopen.top/api/sentences").then(value => console.log("普通promise发请求: ",value))

    //async 与 await 测试发送请求
    async function fn6(){
        const result = await fn5("https://api.apiopen.top/api/sentences");
        console.log("await发请求: ",result)
    }
    fn6()
    console.log('============================ES8_async_await结束===================================');
    console.log('============================ES8_对象扩展方法开始===================================');
    const school = {
        name: 'ddd',
        cities: ['dd', 'tt', 'sz'],
        xueke: ['da','java','yunwei']
    }

    console.log("Object.keys获取所有键: ",Object.keys(school))
    console.log("Object.values获取所有值: ",Object.values(school))
    console.log("Object.entries键值对集合: ",Object.entries(school))
    console.log("键值对集合转Map: ",new Map(Object.entries(school)))

    //包含一些属性特征的信息
    console.log("对象属性的描述对象: ",Object.getOwnPropertyDescriptors(school))

    const obj = Object.create(null,{
        name: {
            //设置值
            value: 'shang',
            //属性特征
            writable: true,
            configurable: true,
            enumerable: true
        }
    })
    console.log(obj)


    console.log('============================ES8_对象扩展方法结束===================================');



</script>


</html>
